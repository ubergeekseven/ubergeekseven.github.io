---
layout: post
title: 4th Axis Calculating Settings and Changing the Post Processor
categories:
- CNC
tags: []
status: publish
type: post
published: true
meta:
  _thumbnail_id: '59'
---
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">

<html><body>
<div class="sqs-html-content">
<p class="" style="white-space:pre-wrap;">Last week, while waiting for something else to finish, I decided to wire up my 4th axis. That was easy enough because the wires matched colors on both sides. Plus, it is only 4 wires. Once connected, I used my MPG to step the motor and it turned while making a terrible noise. But it turned.</p>
<p class="" style="white-space:pre-wrap;">This weekend I decided to do the math needed as well as the research to get this thing going. I have included links to resources I used as well as a google sheet that will allow you to calculate the settings needed for the Mach 3 motor tuning page. The acceleration is just guesswork at this point. But gives a rough estimate of settings to try out. You can work with the actual hardware and the sounds it starts making to determine a better setting for your setup. The velocity settings are not 100% either, but are closer to the actual settings than not. </p>
<p class="" style="white-space:pre-wrap;">Math:</p>
<p class="" style="white-space:pre-wrap;">Depending on your stepper driver, gear ratio and microstepping settings and stepper motor amperage.</p>
<p class="" style="white-space:pre-wrap;"> </p>
<p class="" style="white-space:pre-wrap;">Mine:</p>
<p class="" style="white-space:pre-wrap;">Stepper is a Chinese NEMA23 rated at 3 amps</p>
<p class="" style="white-space:pre-wrap;">Gear ratio 100:1</p>
<p class="" style="white-space:pre-wrap;">Microstepping setting: 10</p>
<p class="" style="white-space:pre-wrap;">Controller used: CNCRP stepper driver which is a leadshine stepper controller, or a clone. Here is the link to the manual for the leadshine controller. <a href="http://www.leadshineusa.com/UploadFile/Down/DM556m.pdf">http://www.leadshineusa.com/UploadFile/Down/DM556m.pdf</a></p>
<p class="" style="white-space:pre-wrap;"> </p>
<p class="" style="white-space:pre-wrap;">Degrees per step = 1.8</p>
<p class="" style="white-space:pre-wrap;">Steps per one revolution = 200 (360/1.8=200 )</p>
<p class="" style="white-space:pre-wrap;">Microstep resolution = 10</p>
<p class="" style="white-space:pre-wrap;">Steps per revolution with microstepping = 2000 (200*10=2,000) steps per 1 revolution, multiplied by microstep resolution.</p>
<p class="" style="white-space:pre-wrap;">Gear ratio = 100:1</p>
<p class="" style="white-space:pre-wrap;">Steps per degree = 555.5556 (10*100/1.8=555.5556)  Microstep resolution*Gear ratio/Degrees per step of actual stepper</p>
<p class="" style="white-space:pre-wrap;"> </p>
<p class="" style="white-space:pre-wrap;">The steps per degree is what you need to enter into Mach 3 to control correctly. Next is to tune the motor for the correct movement. I had to fiddle with this to get the reaction I expected. Velocity and Acceleration values are not exact, at least I cannot find a way of calculating the exact ones needed. But these values work well for my setup. </p>
<p class="" style="white-space:pre-wrap;"> </p>
<p class="" style="white-space:pre-wrap;">Velocity = Mach 3 screen says inches or millimeters per minute(Actually degrees per minute). If set to 1, that would mean that the axis would rotate 1 degree every minute. This means that 1 full rotation would take 360 minutes. </p>
<p class="" style="white-space:pre-wrap;"> </p>
<p class="" style="white-space:pre-wrap;">Acceleration = Mach 3 screen says inches or millimeters per second / per second(actually degrees per second per second) This means that if I wanted to accelerate to full speed and if I set acceleration to 1, the axis would move to full speed by increasing the speed every second by 1 inch (degree) per second. So if moving 360 inches(degrees) it would take 360 seconds to get to full speed. </p>
<p class="" style="white-space:pre-wrap;"> </p>
<p class="" style="white-space:pre-wrap;">So if you were to go with 1 as velocity and 1 as acceleration, the speed would ultimately be the same and you would take 360 minutes to get to 1 rotation.</p>
<p class="" style="white-space:pre-wrap;">If we went with 360 as velocity and 1 as acceleration, then it would take 1 second to get to full speed and 1 minute to rotate 1 time. Because at step 1 it is moving at 1 degree per second and since we are trying to get to 360 degrees in 60 seconds, 1 degree per second brings us there. But we most likely want to go much faster than that. </p>
<p class="" style="white-space:pre-wrap;">Calculate the settings needed for the A axis to properly rotate within Mach 3. I created this little calculator to get you going. The calculated Steps per degree is exact. The other two are there for reference and to give you something to start playing with in mach. Once you find the right settings for your machine, by playing with the values until it works the way you see fit, Enter them into the Mach 3 motor Tuning A axis Page.</p>
<p class="" style="white-space:pre-wrap;">If the embedded spreadsheet does not work for you, you might be on a phone. I cannot get it editable on the phone for some reason. Options are limited for the embed URL options. So here is a link to the shared version on drive. <a href="https://docs.google.com/spreadsheets/d/1rSrvYrUv_5ulQj-uvGdp5XadVdeeEFqyKq82E0U3YKk/edit?usp=sharing" target="_blank">Rotary Calculator</a></p>
</div>
<iframe align="middle" height="500px" src="https://docs.google.com/spreadsheets/d/1rSrvYrUv_5ulQj-uvGdp5XadVdeeEFqyKq82E0U3YKk/edit?usp=sharing&amp;rm=minimal" width="100%"></iframe>
<div class="sqs-html-content">
<p class="" style="white-space:pre-wrap;">If using microstepping, make sure that the driver is set correctly. The driver I use is the default from cncrp, but they said to reference the manual of the leadshine driver. <a href="http://www.leadshineusa.com/productdetail.aspx?type=products&amp;category=stepper-products&amp;producttype=stepper-drives&amp;series=DM&amp;model=DM556">http://www.leadshineusa.com/productdetail.aspx?type=products&amp;category=stepper-products&amp;producttype=stepper-drives&amp;series=DM&amp;model=DM556</a></p>
<p class="" style="white-space:pre-wrap;">According to the sheet, to drive this specific stepper that is on my setup, I had to change the amperage to the closest supported on the driver. The rated amperage is 3 on the stepper, the closest setting on the driver is 3.2Amps. However, I am adding a fan/heat sink to lengthen the life of the stepper. I assume it will go earlier, but they are cheap.</p>
<p class="" style="white-space:pre-wrap;">The driver came without the microstepping set. This threw me off during calculations because the output never aligned and then I realized that sending G0 A36 caused it to rotate one full 360. After finding the manual for the stepper driver, I was able to figure out that the microstepping was not enabled. Makes perfect sense after the fact.</p>
<p class="" style="white-space:pre-wrap;">If you have a similar setup of needing 3Amps and 10 microsteps from the driver, your settings should be this on the dip switches.</p>
</div>
<style type="text/css">
.tg  
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg .tg-0lax
</style>
<table class="tg">
<tr>
<th class="tg-0lax">1</th>
<th class="tg-0lax">2</th>
<th class="tg-0lax">3</th>
<th class="tg-0lax">4</th>
<th class="tg-0lax">5</th>
<th class="tg-0lax">6</th>
<th class="tg-0lax">7</th>
<th class="tg-0lax">8</th>
</tr>
<tr>
<td class="tg-0lax">ON</td>
<td class="tg-0lax">ON</td>
<td class="tg-0lax">OFF</td>
<td class="tg-0lax"></td>
<td class="tg-0lax">OFF</td>
<td class="tg-0lax">ON</td>
<td class="tg-0lax">ON</td>
<td class="tg-0lax">OFF</td>
</tr>
</table>
<div class="image-block-outer-wrapper layout-caption-below design-layout-inline combination-animation-none individual-animation-none individual-text-animation-none" data-test="image-block-inline-outer-wrapper">
<figure class="sqs-block-image-figure intrinsic" style="max-width:888px;">
<div class="image-block-wrapper" data-animation-role="image">
<div class="sqs-image-shape-container-element has-aspect-ratio" style="
                position: relative;
                
                  padding-bottom:64.52703094482422%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              ">
<img alt="Enter the calculated Steps per, Velocity and Acceleration into the A axis settings in the Mach 3 motor tuning page. Do not forget to Save axis settings." data-image="assets/images/old_blog/MACH3Motortuning.PNG" data-image-dimensions="888x573" data-image-focal-point="0.5,0.5" data-load="false" data-loader="sqs" data-stretch="false" decoding="async" height="573" loading="lazy" sizes="100vw" src="assets/images/old_blog/MACH3Motortuning.PNG" srcset="assets/images/old_blog/MACH3Motortuning.PNG" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" width="888"/>
</div>
</div>
<figcaption class="image-caption-wrapper">
<div class="image-caption"><p class="">Enter the calculated Steps per, Velocity and Acceleration into the A axis settings in the Mach 3 motor tuning page. Do not forget to Save axis settings.</p></div>
</figcaption>
</figure>
</div>
<div class="sqs-html-content">
<p class="" style="white-space:pre-wrap;">Once you enter the correct settings you can rotate the axis in mach. Just enter G0 A360 and watch it rotate one full time. Here is a video of mine. Terrible, shaky but you get the point.</p>
</div>
<iframe allowfullscreen="" data-embed="true" data-image-dimensions="854x480" frameborder="0" height="480" scrolling="no" src="//www.youtube.com/embed/WVTH-tk963Y?wmode=opaque&amp;enablejsapi=1" width="854">
</iframe><div class="video-caption-wrapper"><div class="video-caption"><p>A quick video of my rotary axis turning 360 degrees after finally getting the settings correct.</p></div></div>
<div class="sqs-html-content">
<p class="" style="white-space:pre-wrap;">UPDATE!</p>
<p class="" style="white-space:pre-wrap;">I just posted this in another blog post, but wanted to add this step in so you were not confused later on. </p>
<p class="" style="white-space:pre-wrap;">You will need to open config - - ToolPath Configuration and then enable “Use radius for feedrate” and “A- Rotations Enable” before you will get usable speeds on toolpaths you post process. Then go to the settings page and enter 0.0001 as the Rotation Radius. Or possible enter your stock radius. This compensates the speed for distance from Z zero position. I have been raising the z axis .2 above the stock and running the code from there, it compensates when using the .0001 entry, have not tested actual radius yet. I set Z 0 as the center for rotation.</p>
<p class="" style="white-space:pre-wrap;">Fusion 360 Post Processor:</p>
<p class="" style="white-space:pre-wrap;"> </p>
<p class="" style="white-space:pre-wrap;">If using the post processor from CNCRouterParts, then the A axis is not configured by default. I posted on the CNCZone forums about needing help with modifying the post processor and someone wrote back with this short tip here. Open the post processor, I opened it while within the fusion CAM section, by going to the post process action. To do it, you will need to have a setup defined. If the path is not generated, it will throw a warning about wanting to do it anyway. Accept the warning and then when the post processor page opens, choose your post processor if it is not already chosen and then click on "open config". It should open in the brackets code editor.<br/></p>
</div>
<div class="image-block-outer-wrapper layout-caption-below design-layout-inline combination-animation-none individual-animation-none individual-text-animation-none" data-test="image-block-inline-outer-wrapper">
<figure class="sqs-block-image-figure intrinsic" style="max-width:781px;">
<div class="image-block-wrapper" data-animation-role="image">
<div class="sqs-image-shape-container-element has-aspect-ratio" style="
                position: relative;
                
                  padding-bottom:88.98847961425781%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              ">
<img alt="" data-image="assets/images/old_blog/image-asset.png" data-image-dimensions="781x695" data-image-focal-point="0.5,0.5" data-load="false" data-loader="sqs" data-stretch="false" decoding="async" height="695" loading="lazy" sizes="100vw" src="assets/images/old_blog/image-asset.png" srcset="assets/images/old_blog/image-asset.png" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" width="781"/>
</div>
</div>
</figure>
</div>
<div class="sqs-html-content">
<p class="" style="white-space:pre-wrap;">Once you have it opened, search for "Function onOpen" and look for the line </p>
<p class="" style="white-space:pre-wrap;">  <strong>if (false) {</strong></p>
<p class="" style="white-space:pre-wrap;">    var aAxis = createAxis({coordinate:0, table:true, axis:[-1, 0, 0], cyclic:true, preference:1});</p>
<p class="" style="white-space:pre-wrap;">    machineConfiguration = new MachineConfiguration(aAxis);</p>
<p class="" style="white-space:pre-wrap;"><strong> Change if (false) to if (true).</strong></p>
<p class="" style="white-space:pre-wrap;">Next Search for “var tcp”</p>
<p class="" style="white-space:pre-wrap;"><strong>var tcp = true;</strong></p>
<p class="" style="white-space:pre-wrap;">  if (tcp) {</p>
<p class="" style="white-space:pre-wrap;">    setRotation(W); // TCP mode</p>
<p class="" style="white-space:pre-wrap;"><strong>Change var tcp = true to var tcp = false;</strong></p>
<p class="" style="white-space:pre-wrap;"> That is it. I saved this as another post processor instead of overwriting the original. I am pretty sure that if you overwrite the original, it will not choose to post process the A axis unless the CAM refers to a rotary axis. I have not tested this and it is easy enough to switch between them and if you forget, it will be obvious that it did not work anyway.</p>
</div>
<div class="image-block-outer-wrapper layout-caption-below design-layout-inline combination-animation-none individual-animation-none individual-text-animation-none" data-test="image-block-inline-outer-wrapper">
<figure class="sqs-block-image-figure intrinsic" style="max-width:1912px;">
<div class="image-block-wrapper" data-animation-role="image">
<div class="sqs-image-shape-container-element has-aspect-ratio" style="
                position: relative;
                
                  padding-bottom:52.458160400390625%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              ">
<img alt="" data-image="assets/images/old_blog/image-asset.png" data-image-dimensions="1912x1003" data-image-focal-point="0.5,0.5" data-load="false" data-loader="sqs" data-stretch="false" decoding="async" height="1003" loading="lazy" sizes="100vw" src="assets/images/old_blog/image-asset.png" srcset="assets/images/old_blog/image-asset.png" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" width="1912"/>
</div>
</div>
</figure>
</div>
<div class="sqs-html-content">
<p class="" style="white-space:pre-wrap;">This is the end of what I have done so far. I am building the frame setup for mounting this. It will not be permanent, but will be able to use 4 feet of cutting space on the X axis. The setup I have designed does limit my maximum stock size to 8 inches. But having 4 feet to work within was my goal. Table legs and banisters are on the list. Otherwise I would have mounted it under the table and had the cutter reach through. But that is far to limiting in size. Maybe I will do that in the future, or maybe I will try to make it 8 foot with another mounting setup. I will link out to my Fusion design of the mounting and the CAM I used to set up registers on the table when I confirm everything working. Once I post some actual code and turn something, I will add some more. Hopefully this, along with some of the links I have thrown out there of the 2 people with the CNCRP machines that have posted anything, will get you going. </p>
<p class="" style="white-space:pre-wrap;">Please add any information that you have if you do. What did you figure out that can help the rest of us? </p>
</div>
</body></html>
