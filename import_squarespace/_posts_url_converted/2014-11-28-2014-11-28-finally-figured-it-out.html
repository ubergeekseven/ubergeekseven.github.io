---
layout: post
title: FINALLY!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! figured it out
categories: []
tags: []
status: publish
type: post
published: true
meta: {}
---
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">

<html><body>
<div class="sqs-html-content">
<p>And now that I have it figured out, I feel stupid. I guess sleeping on it works.</p>
<p>While trying to get the variable to reset after the button was pushed, i was clearing all of the variables that were sent to the button push. But not the variable that creates the data for the other variables. I just figured that since the value would shift so much all of the time, it would not matter if I did clear it.</p>
<p>But, I cant process information in the linear fashion that this code does, so my brain broke when I tried to reason with it. I am so glad I didn't post this question on Stack Exchange. That would be an invitation for trolling, for sure.</p>
<p>But here is my code as of now.</p>
<p>Â </p>
</div>
<pre class="source-code">

/*
All around joystick to easily create custom layouts 


// this is the address of each button in the 4 bytes 
definitions :
#define BUTTON_1 0x01
#define BUTTON_2 0x02
#define BUTTON_3 0x03
#define BUTTON_4 0x04
#define BUTTON_5 0x05
#define BUTTON_6 0x06
#define BUTTON_7 0x07
#define BUTTON_8 0x08
#define BUTTON_9 0x09
#define BUTTON_10 0x0A
#define BUTTON_11 0x0B
#define BUTTON_12 0x0C
#define BUTTON_13 0x0D
#define BUTTON_14 0x0E
#define BUTTON_15 0x0F
#define BUTTON_16 0x10
#define BUTTON_17 0x11
#define BUTTON_18 0x12
#define BUTTON_19 0x13
#define BUTTON_20 0x14
#define BUTTON_21 0x15
#define BUTTON_22 0x16
#define BUTTON_23 0x17
#define BUTTON_24 0x18
#define BUTTON_25 0x19
#define BUTTON_26 0x1A
#define BUTTON_27 0x1B
#define BUTTON_28 0x1C
#define BUTTON_29 0x1D
#define BUTTON_30 0x1E
#define BUTTON_31 0x1F
#define BUTTON_32 0x20

*/

    #include <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Bounce2.h</span><span class="cm-tag cm-bracket">&gt;</span>
    JoyState_t joySt; // joystick HID descriptor
    
    
    const bool DEBUG = false;  // set to true to debug the raw values
    int BUTTON_1 = 11;// LEFT TRIGGER ON PINBALL
    int BUTTON_2 = 10;//RIGHT TRIGGER ON PINBALL
    int BUTTON_3 = 9; //Used to trigger the value of the pinball shooter at its apex
    int throttlePin = A5; //One Axes for pinball shooter
    int xPin = A2;
    int yPin = A3;
    int xZero, yZero;
    int xValue, yValue;
    int deadzone = 5;  // smaller values will be set to 0
    int throttleValue;// CURRENTLY SET TO PINBALL LAUNCHER
    unsigned int maxRead ; //SET MAXREAD AS THE MAX INPUT FOR THE BALL
    unsigned int lastRead; // last stored reading greater than previous
    unsigned int pushed; //was the button pushed last time?



/**************************************************************************************/
    void setup()
    {

    if(DEBUG) {
        Serial.begin(9600);
               }
    

        maxRead = 0;  //zero the value before loop
        lastRead = 0; // zero the value before loop
        pushed = false;
     
    // Setup the button with an internal pull-up :
  
  
        pinMode(BUTTON_1,INPUT_PULLUP); 
        pinMode(BUTTON_2,INPUT_PULLUP);
        pinMode(throttlePin, INPUT);
        pinMode(xPin, INPUT);
        pinMode(yPin, INPUT);
        pinMode(BUTTON_3,INPUT_PULLUP);      
        xZero = analogRead(xPin);
    yZero = analogRead(yPin);
       
    

    // zero out all axis and button variables 
    joySt.xAxis = 0;
    joySt.yAxis = 0;
    joySt.zAxis = 0;
    joySt.xRotAxis = 0;
    joySt.yRotAxis = 0;
    joySt.zRotAxis = 0;
    joySt.throttle = 0;
    joySt.rudder = 0;
    joySt.hatSw1 = 0;
    joySt.hatSw2 = 0;
    joySt.buttons = 0;

       }


  void loop()
        {
        joySt.buttons = 0x00; // off state
        
   
        if (digitalRead(BUTTON_1) == LOW){
        joySt.buttons += 0x01;
        
        }
        
        if (digitalRead(BUTTON_2) == LOW){
        joySt.buttons += 0x02; //adds the two inputs together
       
        }
        
        if (digitalRead(BUTTON_3) == LOW){ //if the button is pushed set pushed to true and lastread to 0 and set the axis value to the max read. lastread will read on the next loop
           joySt.zAxis = map(maxRead,0,1023,0,255);
           pushed = true;
           delay(1);
           lastRead = 0;
           
        }        
       
        xValue = analogRead(xPin) - xZero;
    yValue = analogRead(yPin) - yZero;

    if(abs(xValue) <span class="cm-tag cm-bracket">&lt;</span> <span class="cm-tag">deadzone)</span> <span class="cm-attribute">{</span>
        <span class="cm-attribute">xValue</span> = <span class="cm-string">0;</span>
    <span class="cm-attribute">}</span>
    <span class="cm-attribute">if(abs(yValue)</span> <span class="cm-error">&lt; deadzone) {</span>
        yValue = 0;
    }

    throttleValue = analogRead(throttlePin);  //(throttlePin) - throttleZero;
    
    
        // THIS SECTION WILL DETERMINE THE LAST HIGHEST READING AND APPLY THAT TO THE BUTTON 
        
        if (throttleValue &gt; lastRead) {
                 lastRead = throttleValue; // store the current throttle value in last read
        }
          else if (throttleValue <span class="cm-tag cm-bracket">&lt;</span><span class="cm-null cm-error">=</span> <span class="cm-tag">lastRead)</span> <span class="cm-attribute">{</span> <span class="cm-attribute">//throttle</span> <span class="cm-attribute">is</span> <span class="cm-attribute">changing</span> <span class="cm-attribute">direction</span> <span class="cm-attribute">so</span> <span class="cm-attribute">record</span> <span class="cm-attribute">th</span> <span class="cm-attribute">elast</span> <span class="cm-attribute">value</span> <span class="cm-attribute">that</span> <span class="cm-attribute">was</span> <span class="cm-attribute">the</span> <span class="cm-attribute">highes</span> <span class="cm-attribute">t</span> <span class="cm-attribute">and</span> <span class="cm-attribute">store</span> <span class="cm-attribute">it</span> 
                 <span class="cm-attribute">maxRead</span> = <span class="cm-string">lastRead;</span>  <span class="cm-attribute">/</span><span class="cm-attribute">/</span> <span class="cm-attribute">store</span> <span class="cm-attribute">the</span> <span class="cm-attribute">max</span> <span class="cm-attribute">value</span> <span class="cm-attribute">in</span> <span class="cm-attribute">last</span> <span class="cm-attribute">read</span>
              
        <span class="cm-attribute">}</span>

        <span class="cm-attribute">if</span> <span class="cm-attribute">(digitalRead(BUTTON_3)</span> =<span class="cm-null cm-error">=</span> <span class="cm-attribute">HIGH</span> <span class="cm-attribute">&amp;&amp;</span> <span class="cm-attribute">(pushed</span> = <span class="cm-string">true)){</span> <span class="cm-attribute">/</span><span class="cm-attribute">/</span> <span class="cm-attribute">if</span> <span class="cm-attribute">the</span> <span class="cm-attribute">button</span> <span class="cm-attribute">is</span> <span class="cm-attribute">pressed</span> <span class="cm-attribute">and</span> <span class="cm-attribute">let</span> <span class="cm-attribute">go,</span> <span class="cm-attribute">set</span> <span class="cm-attribute">the</span> <span class="cm-attribute">axis</span> <span class="cm-attribute">back</span> <span class="cm-attribute">to</span> <span class="cm-attribute">0</span>
           <span class="cm-attribute">joySt.zAxis</span> = <span class="cm-string">0;</span>
           <span class="cm-attribute">pushed</span> = <span class="cm-string">false;</span>
          <span class="cm-attribute">}</span>
          



    <span class="cm-attribute">joySt.xAxis</span> = <span class="cm-string">map(xValue,</span> <span class="cm-attribute">450,</span> <span class="cm-attribute">-450,</span> <span class="cm-attribute">0,</span> <span class="cm-attribute">255);</span>  <span class="cm-attribute">/</span><span class="cm-attribute">/</span> <span class="cm-attribute">here</span> <span class="cm-attribute">the</span> <span class="cm-attribute">axis</span> <span class="cm-attribute">is</span> <span class="cm-attribute">inverted</span>
    <span class="cm-attribute">joySt.yAxis</span> = <span class="cm-string">map(yValue,</span> <span class="cm-attribute">-400,</span> <span class="cm-attribute">400,</span> <span class="cm-attribute">0,</span> <span class="cm-attribute">255);</span>
        <span class="cm-attribute">joySt.throttle</span> = <span class="cm-string">map(throttleValue,0,1023,0,255);</span> <span class="cm-attribute">/</span><span class="cm-attribute">/</span> <span class="cm-attribute">scaling</span> <span class="cm-attribute">the</span> <span class="cm-attribute">throttle</span> <span class="cm-attribute">value</span>
        
        
    <span class="cm-attribute">if(DEBUG)</span> <span class="cm-attribute">{</span>
        <span class="cm-attribute">Serial.print(</span><span class="cm-string cm-error">"X: "</span><span class="cm-attribute">);</span>
        <span class="cm-attribute">Serial.println(xValue);</span>
        <span class="cm-attribute">Serial.print(</span><span class="cm-string cm-error">"Y: "</span><span class="cm-attribute">);</span>
        <span class="cm-attribute">Serial.println(yValue);</span>
                <span class="cm-attribute">Serial.print(</span><span class="cm-string cm-error">"Throttle value"</span><span class="cm-attribute">);</span>
                <span class="cm-attribute">Serial.println(throttleValue);</span>
                <span class="cm-attribute">Serial.print(</span><span class="cm-string cm-error">"maxread"</span><span class="cm-attribute">);</span>
                <span class="cm-attribute">Serial.println(maxRead);</span>
                <span class="cm-attribute">Serial.print(</span><span class="cm-string cm-error">"lastRead"</span><span class="cm-attribute">);</span>
                <span class="cm-attribute">Serial.println(lastRead);</span>
                
    <span class="cm-attribute">}</span>

<span class="cm-attribute">/</span><span class="cm-attribute">/</span>  <span class="cm-attribute">joySt.xAxis</span> = <span class="cm-string">random(255);</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>  <span class="cm-attribute">joySt.yAxis</span> = <span class="cm-string">random(255);</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>  <span class="cm-attribute">joySt.zAxis</span> = <span class="cm-string">random(255);</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>  <span class="cm-attribute">joySt.xRotAxis</span> = <span class="cm-string">random(255);</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>  <span class="cm-attribute">joySt.yRotAxis</span> = <span class="cm-string">random(255);</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>  <span class="cm-attribute">joySt.zRotAxis</span> = <span class="cm-string">random(255);</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>  <span class="cm-attribute">joySt.throttle</span> = <span class="cm-string">random(255);</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>  <span class="cm-attribute">joySt.rudder</span> = <span class="cm-string">random(255);</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>  <span class="cm-attribute">joySt.throttle++;</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>  <span class="cm-attribute">joySt.buttons</span> <span class="cm-tag cm-bracket cm-error">&lt;&lt;</span><span class="cm-null cm-error">=</span> <span class="cm-tag">1;</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>  <span class="cm-attribute">if</span> <span class="cm-attribute">(joySt.buttons</span> =<span class="cm-null cm-error">=</span> <span class="cm-attribute">0)</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>      <span class="cm-attribute">joySt.buttons</span> = <span class="cm-string">1;</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>  <span class="cm-attribute">joySt.hatSw1++;</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>  <span class="cm-attribute">joySt.hatSw2--;</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>
<span class="cm-attribute">/</span><span class="cm-attribute">/</span>  <span class="cm-attribute">if</span> <span class="cm-attribute">(joySt.hatSw1</span> <span class="cm-tag cm-bracket">&gt;</span> 8)
//      joySt.hatSw1 = 0;
//  if (joySt.hatSw2 &gt; 8)
//      joySt.hatSw2 = 8;
//
//  delay(100);
//
//  if (joySt.throttle &gt; 127)
//      digitalWrite(13, HIGH);
//  else
//      digitalWrite(13, LOW);


    // Call Joystick.move
    Joystick.setState(<span class="cm-error">&amp;joySt</span>);

    }</pre>
<div class="sqs-html-content">
<p>These two files enable you to replace the default HID descriptors in the arduino IDE. To use them in your projects, with an arduino leonardo or an arduino pro micro, rename your original files and place them in a folder within the directory. Use the .BAK file extension to remind you that it is a backup. The directory is inÂ C:\Program Files (x86)\Arduino\hardware\arduino\cores\arduino and the files to replace are HID.cpp and USBAPI.h.</p>
<p>The files are below for use. I originaly saw this when first researching @Â <span>http://www.instructables.com/id/Add-a-little-two-analog-axis-thumb-joystick-to-you/?ALLSTEPS</span></p>
<p>Then that pointed towardsÂ http://www.imaginaryindustries.com/blog/?p=80</p>
<p>Which gave me insight in to the working of HID. it is confusing at first, but once you stare at the HID descriptors and play with the descriptor tool from the USB site and some other sites that have java versions of the descriptor tool.</p>
<p>And this is the list of sites I read through to understand this stuff more. It should be comprehensive if you are willing to look through them. I pretty much did all of the googling for you.</p>
<p>http://share.xmarks.com/folder/bookmarks/nOiUcxaHt6</p>
<p>This is using xmarks so its web based.</p>
</div>
<div class="sqs-block-button-container sqs-block-button-container--center" data-alignment="center" data-animation-role="button" data-button-size="medium" data-button-type="primary">
<a class="sqs-block-button-element--medium sqs-button-element--primary sqs-block-button-element" href="/s/HID.cpp">
    HID.cpp
  </a>
</div>
<div class="sqs-block-button-container sqs-block-button-container--center" data-alignment="center" data-animation-role="button" data-button-size="medium" data-button-type="primary">
<a class="sqs-block-button-element--medium sqs-button-element--primary sqs-block-button-element" href="/s/USBAPI.h">
    USBAPI.h
  </a>
</div>
<div class="sqs-block-button-container sqs-block-button-container--center" data-alignment="center" data-animation-role="button" data-button-size="medium" data-button-type="primary">
<a class="sqs-block-button-element--medium sqs-button-element--primary sqs-block-button-element" href="/s/MyJoyStick2.ino">
    Arduino Sketch
  </a>
</div>
<div class="sqs-html-content">
<p id="yui_3_17_2_1_1417106591664_61536"><br/></p>
<p id="yui_3_17_2_1_1417106591664_50159"><br/></p>
</div>
</body></html>
